# -*- ruby -*-

require 'metarake/task'

class MetaRake::Task
  PUBLISHED_DIR = File.join(File.dirname(__FILE__), "_published")

  def published?
    self.targets.map do |tgt|
      File.exist?(File.join(PUBLISHED_DIR, "#{self.to_s}-#{tgt}"))
    end.all?
  end

  def publish!
    mkdir_p PUBLISHED_DIR
    self.targets.each do |tgt|
      install tgt, File.join(PUBLISHED_DIR, "#{self.to_s}-#{tgt}")
    end
  end
end

task :default => MetaRake::Task.discover!
